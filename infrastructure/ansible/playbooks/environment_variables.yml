---
- name: create environment variable files and populate variables
  hosts: droplet
  become: yes
  tasks:

    - name: Ensure project directory exists
      file:
        path: /root/guitar-tabs-app
        state: directory
        mode: '0755'
      
    - name: Create .env.db file for database credentials
      copy:
        dest: /root/guitar-tabs-app/.env.db
        content: |
          POSTGRES_DB={{ database_name }}
          POSTGRES_USER={{ database_user }}
          POSTGRES_PASSWORD={{ database_password }}
          POSTGRES_HOST={{ database_host }}

    - name: Create .env.tabs-api file for tabs-api environment variables
      copy:
        dest: /root/guitar-tabs-app/.env.tabs-api
        content: |
          DATABASE_URL={{ database_url }}